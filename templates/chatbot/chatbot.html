<!-- prettier-ignore -->
{% extends 'base/index.html' %} 
{% load static %} 
{% load markdownify %}
{% block title %}Chatbot{% endblock %}

<!-- prettier-ignore -->
{% block css %}
<link rel="stylesheet" href="{% static 'css/chatbot.css' %}" />
{% endblock %}

<!-- prettier-ignore -->
{% block js %}
<script src="{% static 'js/chatbot.js' %}"></script>
{% endblock %}

<!-- prettier-ignore -->
{% block markedjs %}
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
{% endblock %}

<!-- prettier-ignore -->
{% block content %}
<main class="flex flex-row bg-gray-100 w-full h-[90vh]">
	<!-- 사이드바: 판례 목록 -->
	<div class="w-[25vw] bg-white border-r border-gray-200 p-4 hidden md:flex flex-col h-full">
		<!-- 사용 안내 문구 추가 -->
		<div
			class="text-sm text-gray-700 font-medium bg-blue-50 border border-blue-200 px-3 py-2 rounded-lg mb-4 flex items-center justify-center space-x-2">
			<i class="fas fa-info-circle text-blue-500"></i>
			<span>최대 2개의 판례를 선택할 수 있습니다.</span>
		</div>

		<!-- 상단 슬라이드 컨트롤 -->
		<div class="flex justify-between items-center mb-4">
			{% if page_obj.has_previous %}
			<a
				href="?page={{ page_obj.previous_page_number }}"
				class="text-gray-500 hover:text-law-blue">
				<i class="fas fa-chevron-up"></i>
			</a>
			{% else %}
			<span class="text-gray-300"><i class="fas fa-chevron-up"></i></span>
			{% endif %}

			<span class="text-sm text-gray-500">
				<span class="font-semibold text-gray-800">{{ page_obj.number }}</span>
				<span class="text-gray-400">/</span>
				<span class="text-gray-500">{{ page_obj.paginator.num_pages }}</span>
			</span>

			{% if page_obj.has_next %}
			<a
				href="?page={{ page_obj.next_page_number }}"
				class="text-gray-500 hover:text-law-blue">
				<i class="fas fa-chevron-down"></i>
			</a>
			{% else %}
			<span class="text-gray-300"><i class="fas fa-chevron-down"></i></span>
			{% endif %}
		</div>

		<!-- 판례 목록 -->
		<div class="flex-1 overflow-y-auto space-y-3">
			{% for case in cases %}
			<div
				id="case-{{ case.case_id }}"
				class="case-item p-3 h-[100px] border border-gray-200 rounded-lg hover:bg-blue-100 cursor-pointer group relative flex flex-col justify-between transition-colors duration-150"
				data-case-id="{{ case.case_id }}"
				data-case-num="{{ case.case_num }}">
				<div>
					<div class="flex space-x-1">
						<div class="w-1/2 text-sm font-medium text-gray-800 truncate">
							{{ case.case_num }}
						</div>
						<div class="w-1/2 text-sm font-medium text-gray-800 truncate">
							{{ case.case_name }}
						</div>
					</div>
					<div class="mt-1">
						<div
							class="text-xs text-gray-500 leading-snug w-1/2 break-words overflow-hidden line-clamp-2">
							{% for kw in case.keywords %}
							<span>#{{ kw }}</span>
							{% endfor %}
						</div>
					</div>
				</div>
				<a
					href="{% url 'case-detail' case.case_id %}"
					target="_blank"
					class="flex items-center text-gray-500 hover:text-law-blue text-xs absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition">
					<i class="fas fa-external-link-alt text-sm"></i>
					<span class="ml-1">전문 보기</span>
				</a>
			</div>
			{% endfor %}
		</div>

		<!-- 하단 슬라이드 컨트롤 -->
		<div class="flex justify-between items-center mt-4">
			{% if page_obj.has_previous %}
			<a
				href="?page={{ page_obj.previous_page_number }}"
				class="text-gray-500 hover:text-law-blue">
				<i class="fas fa-chevron-up"></i>
			</a>
			{% else %}
			<span class="text-gray-300"><i class="fas fa-chevron-up"></i></span>
			{% endif %}

			<span class="text-sm text-gray-500">
				<span class="font-semibold text-gray-800">{{ page_obj.number }}</span>
				<span class="text-gray-400">/</span>
				<span class="text-gray-500">{{ page_obj.paginator.num_pages }}</span>
			</span>

			{% if page_obj.has_next %}
			<a
				href="?page={{ page_obj.next_page_number }}"
				class="text-gray-500 hover:text-law-blue">
				<i class="fas fa-chevron-down"></i>
			</a>
			{% else %}
			<span class="text-gray-300"><i class="fas fa-chevron-down"></i></span>
			{% endif %}
		</div>
	</div>

	<!-- 메인 챗봇 영역 -->
	<div class="w-[75vw] flex items-center justify-center px-4 md:px-8 lg:px-0 h-full">
		<div class="w-full h-full flex flex-col">
			<div
				class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 w-full h-full flex flex-col">
				<div class="flex flex-col flex-1 min-h-0">
					<!-- 메시지 영역 -->
					<div
						class="flex-1 overflow-y-auto hide-scrollbar p-6 space-y-6 bg-gray-50 rounded-lg mb-2 min-h-0">
						<!-- JS로 메시지 추가 -->
					</div>
					<!-- 선택된 판례 표시 영역 -->
					<div
						id="selected-cases-summary"
						class="text-sm text-blue-600 font-sans font-normal"
						style="font-family: Noto Sans KR, sans-serif">
						선택된 판례: 없음
					</div>

					<!-- 입력창 -->
					<div class="flex items-center justify-center mt-2">
						<form id="chat-form" class="w-full flex items-center space-x-2">
							<input
								type="text"
								id="chat-input"
								placeholder="메시지를 입력하세요..."
								class="flex-1 border border-gray-300 rounded-lg px-4 py-4 focus:outline-none focus:ring-2 focus:ring-law-blue focus:border-transparent" />
							<button
								type="submit"
								class="bg-law-blue hover:bg-law-darkblue text-white px-6 py-4 rounded-lg transition">
								<i class="fas fa-paper-plane"></i>
							</button>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
</main>
{% endblock %}
